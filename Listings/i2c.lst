


ARM Macro Assembler    Page 1 


    1 00000000         ;Register           EQU     Address
    2 00000000         ;----------------- -----   ------------
    3 00000000 400FE608 
                       RCGCGPIO
                               EQU              0x400FE608
    4 00000000 400FE620 
                       RCGCI2C EQU              0x400FE620
    5 00000000 40005420 
                       GPIOAFSEL
                               EQU              0x40005420
    6 00000000 4000550C 
                       GPIOODR EQU              0x4000550C
    7 00000000 4000552C 
                       GPIOPCTL
                               EQU              0x4000552C
    8 00000000 40020220 
                       I2CMCR  EQU              0x40020220
    9 00000000 4002000C 
                       I2CMTPR EQU              0x4002000C
   10 00000000 40020000 
                       I2CMSA  EQU              0x40020000
   11 00000000 40020008 
                       I2CMDR  EQU              0x40020008
   12 00000000 40020004 
                       I2CMCS  EQU              0x40020004
   13 00000000         
   14 00000000                 AREA             |.text|, READONLY, CODE, ALIGN=
2
   15 00000000                 THUMB
   16 00000000         
   17 00000000                 EXPORT           writeToDac  ; Make available
   18 00000000         
   19 00000000         writeToDac
                               PROC
   20 00000000         ;Use R3 for storing data
   21 00000000         
   22 00000000         ; Set the slave address to 0x60
   23 00000000 4923    idle    LDR              R1, =I2CMSA
   24 00000002 F04F 0060       MOV              R0, #0x60
   25 00000006 6008            STR              R0, [R1]
   26 00000008         
   27 00000008         ;Place data (byte) to be transmitted in the data registe
                       r 
   28 00000008         ;by writing the I2CMDR register with the desired data
   29 00000008         
   30 00000008 F854 3B01       LDR              R3,[R4],#1  ; Post Increment
   31 0000000C EA4F 1313       LSR              R3, #4      ;Shift since we are
                                                             only using 4 bits
   32 00000010 4920            LDR              R1, =I2CMDR
   33 00000012 600B            STR              R3, [R1]
   34 00000014         
   35 00000014         
   36 00000014 4920    read_mcs
                               LDR              R1, =I2CMCS
   37 00000016         ;Wait until busbusy is cleared
   38 00000016 680A            LDR              R2, [R1]
   39 00000018 F002 0240       AND              R2, #0x40   ;
   40 0000001C 2A00            CMP              R2, #0
   41 0000001E D1F9            BNE              read_mcs



ARM Macro Assembler    Page 2 


   42 00000020         
   43 00000020         ;Initiate a single byte transmit of the data from Master
                        to Slave
   44 00000020 491D            LDR              R1, =I2CMCS
   45 00000022 F04F 0003       MOV              R0, #0x03
   46 00000026 6008            STR              R0, [R1]
   47 00000028         
   48 00000028         ;NOP
   49 00000028         ;NOP
   50 00000028         ;NOP
   51 00000028         
   52 00000028         ;check busy bit
   53 00000028 491B    read_again
                               LDR              R1, =I2CMCS
   54 0000002A 680A            LDR              R2, [R1]
   55 0000002C F002 0201       AND              R2, #0x1
   56 00000030 2A00            CMP              R2, #0
   57 00000032 D1F9            BNE              read_again
   58 00000034         ;check error bit  in the I2CMCS register to confirm the 
                       transmit was acknowledged
   59 00000034 680A            LDR              R2, [R1]
   60 00000036 F002 0202       AND              R2, #0x02
   61 0000003A 2A00            CMP              R2, #0
   62 0000003C D104            BNE              error
   63 0000003E D008            BEQ              continue
   64 00000040         
   65 00000040 F04F 0004 
                       write_mcs
                               MOV              R0, #0x04
   66 00000044 6008            STR              R0, [R1]
   67 00000046 E7DB            B                idle
   68 00000048         ;ARBLST bit=1?
   69 00000048 680A    error   LDR              R2, [R1]
   70 0000004A F002 0210       AND              R2, #0x10
   71 0000004E 2A00            CMP              R2, #0
   72 00000050 D1F6            BNE              write_mcs
   73 00000052         ;if error bit is zero
   74 00000052         
   75 00000052 6823    continue
                               LDR              R3,[R4]     ; Don't need to Pos
                                                            t Increment (Alread
                                                            y Done Above)
   76 00000054 EA4F 1303       LSL              R3,#4       ;Shift since we are
                                                             only using 4 bits
   77 00000058 490E            LDR              R1, =I2CMDR
   78 0000005A 600B            STR              R3, [R1]
   79 0000005C         ;check index
   80 0000005C         
   81 0000005C 490E            LDR              R1, =I2CMCS
   82 0000005E F04F 0001       MOV              R0, #0x01
   83 00000062 6008            STR              R0, [R1]
   84 00000064         
   85 00000064         ;check busy bit
   86 00000064 490C    read_ag LDR              R1, =I2CMCS
   87 00000066 680A            LDR              R2, [R1]
   88 00000068 F002 0201       AND              R2, #0x1
   89 0000006C 2A00            CMP              R2, #0
   90 0000006E D1F9            BNE              read_ag
   91 00000070         



ARM Macro Assembler    Page 3 


   92 00000070 4909            LDR              R1, =I2CMCS
   93 00000072 680A            LDR              R2, [R1]
   94 00000074 F002 0201       AND              R2, #0x1
   95 00000078 2A00            CMP              R2, #0
   96 0000007A         
   97 0000007A         
   98 0000007A         ;check error bit  in the I2CMCS register to confirm the 
                       transmit was acknowledged
   99 0000007A 680A            LDR              R2, [R1]
  100 0000007C F002 0202       AND              R2, #0x02
  101 00000080 2A00            CMP              R2, #0
  102 00000082 D1BD            BNE              idle
  103 00000084         
  104 00000084 4904            LDR              R1, =I2CMCS
  105 00000086 F04F 0004       MOV              R0, #0x04
  106 0000008A 6008            STR              R0, [R1]
  107 0000008C         
  108 0000008C         ;B  idle
  109 0000008C         
  110 0000008C 4770            BX               LR          ; Return
  111 0000008E         
  112 0000008E                 ENDP
  113 0000008E 00 00           ALIGN
  114 00000090                 END
              40020000 
              40020008 
              40020004 
Command Line: --debug --xref --diag_suppress=9931 --cpu=Cortex-M4.fp --apcs=int
erwork --depend=.\objects\i2c.d -o.\objects\i2c.o -I.\RTE\_Target_1 -IC:\Keil_v
5\ARM\PACK\Keil\TM4C_DFP\1.1.0\Device\Include\TM4C123 -IC:\Keil_v5\ARM\CMSIS\In
clude --predefine="__EVAL SETA 1" --predefine="__UVISION_VERSION SETA 524" --pr
edefine="TM4C1231H6PM SETA 1" --list=.\listings\i2c.lst codes\I2C.s



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
Relocatable symbols

.text 00000000

Symbol: .text
   Definitions
      At line 14 in file codes\I2C.s
   Uses
      None
Comment: .text unused
continue 00000052

Symbol: continue
   Definitions
      At line 75 in file codes\I2C.s
   Uses
      At line 63 in file codes\I2C.s
Comment: continue used once
error 00000048

Symbol: error
   Definitions
      At line 69 in file codes\I2C.s
   Uses
      At line 62 in file codes\I2C.s
Comment: error used once
idle 00000000

Symbol: idle
   Definitions
      At line 23 in file codes\I2C.s
   Uses
      At line 67 in file codes\I2C.s
      At line 102 in file codes\I2C.s

read_ag 00000064

Symbol: read_ag
   Definitions
      At line 86 in file codes\I2C.s
   Uses
      At line 90 in file codes\I2C.s
Comment: read_ag used once
read_again 00000028

Symbol: read_again
   Definitions
      At line 53 in file codes\I2C.s
   Uses
      At line 57 in file codes\I2C.s
Comment: read_again used once
read_mcs 00000014

Symbol: read_mcs
   Definitions
      At line 36 in file codes\I2C.s
   Uses
      At line 41 in file codes\I2C.s
Comment: read_mcs used once
writeToDac 00000000




ARM Macro Assembler    Page 2 Alphabetic symbol ordering
Relocatable symbols

Symbol: writeToDac
   Definitions
      At line 19 in file codes\I2C.s
   Uses
      At line 17 in file codes\I2C.s
Comment: writeToDac used once
write_mcs 00000040

Symbol: write_mcs
   Definitions
      At line 65 in file codes\I2C.s
   Uses
      At line 72 in file codes\I2C.s
Comment: write_mcs used once
9 symbols



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
Absolute symbols

GPIOAFSEL 40005420

Symbol: GPIOAFSEL
   Definitions
      At line 5 in file codes\I2C.s
   Uses
      None
Comment: GPIOAFSEL unused
GPIOODR 4000550C

Symbol: GPIOODR
   Definitions
      At line 6 in file codes\I2C.s
   Uses
      None
Comment: GPIOODR unused
GPIOPCTL 4000552C

Symbol: GPIOPCTL
   Definitions
      At line 7 in file codes\I2C.s
   Uses
      None
Comment: GPIOPCTL unused
I2CMCR 40020220

Symbol: I2CMCR
   Definitions
      At line 8 in file codes\I2C.s
   Uses
      None
Comment: I2CMCR unused
I2CMCS 40020004

Symbol: I2CMCS
   Definitions
      At line 12 in file codes\I2C.s
   Uses
      At line 36 in file codes\I2C.s
      At line 44 in file codes\I2C.s
      At line 53 in file codes\I2C.s
      At line 81 in file codes\I2C.s
      At line 86 in file codes\I2C.s
      At line 92 in file codes\I2C.s
      At line 104 in file codes\I2C.s

I2CMDR 40020008

Symbol: I2CMDR
   Definitions
      At line 11 in file codes\I2C.s
   Uses
      At line 32 in file codes\I2C.s
      At line 77 in file codes\I2C.s

I2CMSA 40020000

Symbol: I2CMSA
   Definitions



ARM Macro Assembler    Page 2 Alphabetic symbol ordering
Absolute symbols

      At line 10 in file codes\I2C.s
   Uses
      At line 23 in file codes\I2C.s
Comment: I2CMSA used once
I2CMTPR 4002000C

Symbol: I2CMTPR
   Definitions
      At line 9 in file codes\I2C.s
   Uses
      None
Comment: I2CMTPR unused
RCGCGPIO 400FE608

Symbol: RCGCGPIO
   Definitions
      At line 3 in file codes\I2C.s
   Uses
      None
Comment: RCGCGPIO unused
RCGCI2C 400FE620

Symbol: RCGCI2C
   Definitions
      At line 4 in file codes\I2C.s
   Uses
      None
Comment: RCGCI2C unused
10 symbols
355 symbols in table
