


ARM Macro Assembler    Page 1 


    1 00000000         ;Register           EQU     Address
    2 00000000         ;----------------- -----   ------------
    3 00000000 400FE608 
                       RCGCGPIO
                               EQU              0x400FE608
    4 00000000 400FE620 
                       RCGCI2C EQU              0x400FE620
    5 00000000 40005420 
                       GPIOAFSEL
                               EQU              0x40005420
    6 00000000 4000550C 
                       GPIOODR EQU              0x4000550C
    7 00000000 4000552C 
                       GPIOPCTL
                               EQU              0x4000552C
    8 00000000 40020220 
                       I2CMCR  EQU              0x40020220
    9 00000000 4002000C 
                       I2CMTPR EQU              0x4002000C
   10 00000000 40020000 
                       I2CMSA  EQU              0x40020000
   11 00000000 40020008 
                       I2CMDR  EQU              0x40020008
   12 00000000 40020004 
                       I2CMCS  EQU              0x40020004
   13 00000000         
   14 00000000                 AREA             |.text|, READONLY, CODE, ALIGN=
2
   15 00000000                 THUMB
   16 00000000         
   17 00000000                 EXPORT           writeToDac  ; Make available
   18 00000000         
   19 00000000         writeToDac
                               PROC
   20 00000000         
   21 00000000 B500            PUSH             {LR}
   22 00000002         ;Use R3 for storing data
   23 00000002         
   24 00000002         ; Set the slave address to 0x60
   25 00000002 4924    idle    LDR              R1, =I2CMSA
   26 00000004 F04F 00C0       MOV              R0, #0xC0   ; 
   27 00000008 6008            STR              R0, [R1]
   28 0000000A         
   29 0000000A         ;Place data (byte) to be transmitted in the data registe
                       r 
   30 0000000A         ;by writing the I2CMDR register with the desired data
   31 0000000A         
   32 0000000A F814 3B01       LDRB             R3,[R4],#1  ; Post Increment
   33 0000000E EA4F 1313       LSR              R3, #4      ;Shift since we are
                                                             only using 4 bits
   34 00000012 4921            LDR              R1, =I2CMDR
   35 00000014 600B            STR              R3, [R1]
   36 00000016         
   37 00000016         
   38 00000016 4921    read_mcs
                               LDR              R1, =I2CMCS
   39 00000018         ;Wait until busbusy is cleared
   40 00000018 680A            LDR              R2, [R1]
   41 0000001A F002 0240       AND              R2, #0x40   ;



ARM Macro Assembler    Page 2 


   42 0000001E 2A00            CMP              R2, #0
   43 00000020 D1F9            BNE              read_mcs
   44 00000022         
   45 00000022         ;Initiate a single byte transmit of the data from Master
                        to Slave
   46 00000022 491E            LDR              R1, =I2CMCS
   47 00000024 F04F 0003       MOV              R0, #0x03
   48 00000028 6008            STR              R0, [R1]
   49 0000002A         
   50 0000002A         ;NOP
   51 0000002A         ;NOP
   52 0000002A         ;NOP
   53 0000002A         
   54 0000002A         ;check busy bit
   55 0000002A 491C    read_again
                               LDR              R1, =I2CMCS
   56 0000002C 680A            LDR              R2, [R1]
   57 0000002E F002 0201       AND              R2, #0x1
   58 00000032 2A00            CMP              R2, #0
   59 00000034 D1F9            BNE              read_again
   60 00000036         ;check error bit  in the I2CMCS register to confirm the 
                       transmit was acknowledged
   61 00000036 680A            LDR              R2, [R1]
   62 00000038 F002 0202       AND              R2, #0x02
   63 0000003C 2A00            CMP              R2, #0
   64 0000003E D104            BNE              error
   65 00000040 D008            BEQ              continue
   66 00000042         
   67 00000042 F04F 0004 
                       write_mcs
                               MOV              R0, #0x04
   68 00000046 6008            STR              R0, [R1]
   69 00000048 E7DB            B                idle
   70 0000004A         ;ARBLST bit=1?
   71 0000004A 680A    error   LDR              R2, [R1]
   72 0000004C F002 0210       AND              R2, #0x10
   73 00000050 2A00            CMP              R2, #0
   74 00000052 D1F6            BNE              write_mcs
   75 00000054         ;if error bit is zero
   76 00000054         
   77 00000054 7823    continue
                               LDRB             R3,[R4]     ; Don't need to Pos
                                                            t Increment (Alread
                                                            y Done Above)
   78 00000056 EA4F 1303       LSL              R3,#4       ;Shift since we are
                                                             only using 4 bits
   79 0000005A 490F            LDR              R1, =I2CMDR
   80 0000005C 600B            STR              R3, [R1]
   81 0000005E         ;check index
   82 0000005E         
   83 0000005E 490F            LDR              R1, =I2CMCS
   84 00000060 F04F 0001       MOV              R0, #0x01
   85 00000064 6008            STR              R0, [R1]
   86 00000066         
   87 00000066         ;check busy bit
   88 00000066 490D    read_ag LDR              R1, =I2CMCS
   89 00000068 680A            LDR              R2, [R1]
   90 0000006A F002 0201       AND              R2, #0x1
   91 0000006E 2A00            CMP              R2, #0



ARM Macro Assembler    Page 3 


   92 00000070 D1F9            BNE              read_ag
   93 00000072         
   94 00000072 490A            LDR              R1, =I2CMCS
   95 00000074 680A            LDR              R2, [R1]
   96 00000076 F002 0201       AND              R2, #0x1
   97 0000007A 2A00            CMP              R2, #0
   98 0000007C         
   99 0000007C         
  100 0000007C         ;check error bit  in the I2CMCS register to confirm the 
                       transmit was acknowledged
  101 0000007C 680A            LDR              R2, [R1]
  102 0000007E F002 0202       AND              R2, #0x02
  103 00000082 2A00            CMP              R2, #0
  104 00000084 D1BD            BNE              idle
  105 00000086         
  106 00000086 4905            LDR              R1, =I2CMCS
  107 00000088 F04F 0004       MOV              R0, #0x04
  108 0000008C 6008            STR              R0, [R1]
  109 0000008E         
  110 0000008E         ;B  idle
  111 0000008E F85D EB04       POP              {LR}
  112 00000092 4770            BX               LR          ; Return
  113 00000094         
  114 00000094                 ENDP
  115 00000094                 ALIGN
  116 00000094                 END
              40020000 
              40020008 
              40020004 
Command Line: --debug --xref --diag_suppress=9931 --cpu=Cortex-M4.fp --apcs=int
erwork --depend=.\objects\i2c.d -o.\objects\i2c.o -I.\RTE\_Target_1 -IC:\Keil_v
5\ARM\PACK\Keil\TM4C_DFP\1.1.0\Device\Include\TM4C123 -IC:\Keil_v5\ARM\CMSIS\In
clude --predefine="__EVAL SETA 1" --predefine="__UVISION_VERSION SETA 524" --pr
edefine="TM4C1231H6PM SETA 1" --list=.\listings\i2c.lst codes\I2C.s



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
Relocatable symbols

.text 00000000

Symbol: .text
   Definitions
      At line 14 in file codes\I2C.s
   Uses
      None
Comment: .text unused
continue 00000054

Symbol: continue
   Definitions
      At line 77 in file codes\I2C.s
   Uses
      At line 65 in file codes\I2C.s
Comment: continue used once
error 0000004A

Symbol: error
   Definitions
      At line 71 in file codes\I2C.s
   Uses
      At line 64 in file codes\I2C.s
Comment: error used once
idle 00000002

Symbol: idle
   Definitions
      At line 25 in file codes\I2C.s
   Uses
      At line 69 in file codes\I2C.s
      At line 104 in file codes\I2C.s

read_ag 00000066

Symbol: read_ag
   Definitions
      At line 88 in file codes\I2C.s
   Uses
      At line 92 in file codes\I2C.s
Comment: read_ag used once
read_again 0000002A

Symbol: read_again
   Definitions
      At line 55 in file codes\I2C.s
   Uses
      At line 59 in file codes\I2C.s
Comment: read_again used once
read_mcs 00000016

Symbol: read_mcs
   Definitions
      At line 38 in file codes\I2C.s
   Uses
      At line 43 in file codes\I2C.s
Comment: read_mcs used once
writeToDac 00000000




ARM Macro Assembler    Page 2 Alphabetic symbol ordering
Relocatable symbols

Symbol: writeToDac
   Definitions
      At line 19 in file codes\I2C.s
   Uses
      At line 17 in file codes\I2C.s
Comment: writeToDac used once
write_mcs 00000042

Symbol: write_mcs
   Definitions
      At line 67 in file codes\I2C.s
   Uses
      At line 74 in file codes\I2C.s
Comment: write_mcs used once
9 symbols



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
Absolute symbols

GPIOAFSEL 40005420

Symbol: GPIOAFSEL
   Definitions
      At line 5 in file codes\I2C.s
   Uses
      None
Comment: GPIOAFSEL unused
GPIOODR 4000550C

Symbol: GPIOODR
   Definitions
      At line 6 in file codes\I2C.s
   Uses
      None
Comment: GPIOODR unused
GPIOPCTL 4000552C

Symbol: GPIOPCTL
   Definitions
      At line 7 in file codes\I2C.s
   Uses
      None
Comment: GPIOPCTL unused
I2CMCR 40020220

Symbol: I2CMCR
   Definitions
      At line 8 in file codes\I2C.s
   Uses
      None
Comment: I2CMCR unused
I2CMCS 40020004

Symbol: I2CMCS
   Definitions
      At line 12 in file codes\I2C.s
   Uses
      At line 38 in file codes\I2C.s
      At line 46 in file codes\I2C.s
      At line 55 in file codes\I2C.s
      At line 83 in file codes\I2C.s
      At line 88 in file codes\I2C.s
      At line 94 in file codes\I2C.s
      At line 106 in file codes\I2C.s

I2CMDR 40020008

Symbol: I2CMDR
   Definitions
      At line 11 in file codes\I2C.s
   Uses
      At line 34 in file codes\I2C.s
      At line 79 in file codes\I2C.s

I2CMSA 40020000

Symbol: I2CMSA
   Definitions



ARM Macro Assembler    Page 2 Alphabetic symbol ordering
Absolute symbols

      At line 10 in file codes\I2C.s
   Uses
      At line 25 in file codes\I2C.s
Comment: I2CMSA used once
I2CMTPR 4002000C

Symbol: I2CMTPR
   Definitions
      At line 9 in file codes\I2C.s
   Uses
      None
Comment: I2CMTPR unused
RCGCGPIO 400FE608

Symbol: RCGCGPIO
   Definitions
      At line 3 in file codes\I2C.s
   Uses
      None
Comment: RCGCGPIO unused
RCGCI2C 400FE620

Symbol: RCGCI2C
   Definitions
      At line 4 in file codes\I2C.s
   Uses
      None
Comment: RCGCI2C unused
10 symbols
355 symbols in table
